NAME = cub3D
CC = cc
CFLAGS = -Wall -Wextra -Werror -g3

SRC_PATH = src/
SRC = main.c \
	utils/clean.c \
	utils/mlx_utils.c \
	player/inputs.c \
	player/movements.c \
	ray/ray_casting.c \
	ray/env_render.c \
	ray/dda.c \
	map/init.c \
	parsing/gest_err.c\
	parsing/gest_id.c\
	parsing/parsing.c\
	parsing/str2arr.c\
	parsing/utils.c \
	parsing/fill_struct.c\
	parsing/gest_map.c\
	lib/ft_calloc.c\
	lib/ft_realloc.c\
	lib/ft_strcmp.c\
	lib/ft_strlen.c\
	lib/ft_strchr.c\
	lib/ft_strdup.c\
	lib/fd_putstr.c\
	lib/ft_strncmp.c\

SRCS = $(addprefix $(SRC_PATH), $(SRC))
OBJ_PATH = obj/
OBJ = $(SRC:.c=.o)
OBJS = $(addprefix $(OBJ_PATH), $(OBJ))

# MLX
MLX_PATH = includes/mlx/
MLX_NAME = libmlx.a
MLX = $(MLX_PATH)$(MLX_NAME)

# Flags
LFLAGS = -L$(MLX_PATH) -lmlx -lXext -lX11 -lm -lz
INC = -I./includes/

all: $(OBJ_PATH) $(MLX) $(NAME)

$(OBJ_PATH):
	@mkdir -p $(OBJ_PATH)
	@mkdir -p $(OBJ_PATH)/utils
	@mkdir -p $(OBJ_PATH)/player
	@mkdir -p $(OBJ_PATH)/ray
	@mkdir -p $(OBJ_PATH)/map
	@mkdir -p $(OBJ_PATH)/parsing
	@mkdir -p $(OBJ_PATH)/lib

$(MLX):
	@if [ ! -d "$(MLX_PATH)" ]; then \
		printf "[MINILIBX]\n"; \
		printf "âŒ› Installing minilibx...\n"; \
		git clone -q https://github.com/42Paris/minilibx-linux.git $(MLX_PATH) && \
		printf "  â””âš™ï¸ Compiling minilibx...\n"; \
		make -C $(MLX_PATH) > /dev/null 2>&1 && \
		printf "    â””âœ… minilibx installed!\n"; \
	elif [ ! -f "$(MLX)" ]; then \
		printf "âš™ï¸  Compiling minilibx...\n"; \
		make -C $(MLX_PATH) > /dev/null 2>&1 && \
		printf "âœ… minilibx compiled!\n"; \
	fi

$(OBJ_PATH)%.o: $(SRC_PATH)%.c
	@printf "\033[2K\râŒ› Compilation: $<"
	@$(CC) $(CFLAGS) $(INC) -c $< -o $@

$(NAME): $(OBJS)
	@$(CC) $(CFLAGS) $(OBJS) -o $(NAME) $(LFLAGS)

clean:
	@printf "\nğŸ—‘ï¸  Removing object files...\n"
	@rm -rf $(OBJ_PATH)
	@if [ -d "$(MLX_PATH)" ]; then \
		printf "ğŸ§¹ Cleaning mlx\n"; \
		make clean -C $(MLX_PATH) > /dev/null 2>&1; \
		printf "  â””âœ… mlx cleaned!\n"; \
	fi
	@printf "âœ… Cleaning completed!\n\n"

norm:
	@printf "ğŸ“‹ Checking norm...\n"
	@norminette includes/cub3d.h
	@norminette $(SRC_PATH)
	@printf "âœ… Check completed!\n"

fclean: clean
	@printf "ğŸ—‘ï¸  Removing the executable $(NAME)...\n"
	@rm -rf $(NAME)
	@printf "  â””âœ… Executable removed!\n"
	@printf "\nâœ… Full cleaning completed!\n\n"

re: fclean all

.PHONY: all clean fclean re norm
